åœ¨ `Spring Security 5+` ä¸­ï¼Œå¦‚æœä½ å¸Œæœ› **æœªç™»å½•çš„ç”¨æˆ·è·³è½¬åˆ°ç™»å½•é¡µé¢**ï¼Œéœ€è¦åœ¨ `SecurityConfig` é‡Œé…ç½® **è‡ªå®šä¹‰æœªæˆæƒå¤„ç†é€»è¾‘**ã€‚

* * *

## âœ¨ **æ–¹æ¡ˆ 1ï¼šé‡å®šå‘åˆ°ç™»å½•é¡µ**

å¦‚æœä½ å¸Œæœ› **æœªç™»å½•æ—¶è·³è½¬åˆ° `/auth/login` é¡µé¢**ï¼Œå¯ä»¥è¿™æ ·é…ç½®ï¼š

```
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;
import org.springframework.security.web.authentication.Http403ForbiddenEntryPoint;
import org.springframework.security.web.authentication.LoginUrlAuthenticationEntryPoint;

@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
                // ç¦ç”¨basicè®¤è¯
                .httpBasic(AbstractHttpConfigurer::disable)
                .csrf().disable()
                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)
                .and()
                .authorizeRequests()
                .antMatchers("/auth/login").permitAll() // ç™»å½•æ¥å£æ”¾è¡Œ
                .antMatchers("/user/getUserByName").permitAll() // å…¬å¼€æ¥å£æ”¾è¡Œ
                .antMatchers("/user/search").permitAll() // å…¬å¼€æ¥å£æ”¾è¡Œ
                .anyRequest().authenticated()
                .and()
                .exceptionHandling()
                // **æœªç™»å½•æ—¶é‡å®šå‘åˆ° `/auth/login`**
                .authenticationEntryPoint(new LoginUrlAuthenticationEntryPoint("/auth/login"));

        return http.build();
    }
}
```

ğŸ”¹ **æ•ˆæœ**ï¼š

-   **æœªç™»å½•è®¿é—®** å—ä¿æŠ¤çš„æ¥å£æ—¶ï¼ŒSecurity **è‡ªåŠ¨è·³è½¬åˆ° `/auth/login`** é¡µé¢ã€‚

* * *

## âœ¨ **æ–¹æ¡ˆ 2ï¼šå‰åç«¯åˆ†ç¦»ï¼Œè¿”å› JSON**

å¦‚æœä½ æ˜¯ **å‰åç«¯åˆ†ç¦»** é¡¹ç›®ï¼Œè€Œä¸æ˜¯ `Spring MVC` ç›´æ¥æ¸²æŸ“é¡µé¢ï¼Œ**æ¨èè¿”å› JSON æç¤ºæœªç™»å½•**ï¼š

```
import org.springframework.security.web.AuthenticationEntryPoint;
import com.fasterxml.jackson.databind.ObjectMapper;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import java.io.IOException;

public class CustomAuthenticationEntryPoint implements AuthenticationEntryPoint {
    @Override
    public void commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException) throws IOException {
        response.setContentType("application/json;charset=UTF-8");
        response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);
        response.getWriter().write(new ObjectMapper().writeValueAsString(
            Map.of("code", 401, "message", "æœªç™»å½•æˆ–ç™»å½•å·²å¤±æ•ˆï¼Œè¯·å…ˆç™»å½•")
        ));
    }
}
```

ç„¶ååœ¨ `SecurityConfig` é‡Œé…ç½®ï¼š

```
.and()
.exceptionHandling()
.authenticationEntryPoint(new CustomAuthenticationEntryPoint());
```

ğŸ”¹ **æ•ˆæœ**ï¼š

-   **æœªç™»å½•è®¿é—®** å—ä¿æŠ¤çš„æ¥å£æ—¶ï¼Œè¿”å›ï¼š

```
{
  "code": 401,
  "message": "æœªç™»å½•æˆ–ç™»å½•å·²å¤±æ•ˆï¼Œè¯·å…ˆç™»å½•"
}
```

* * *

## ğŸš€ **æœ€ç»ˆå»ºè®®**

-   **å¦‚æœæ˜¯ `Spring MVC` ç›´æ¥æ¸²æŸ“é¡µé¢ â†’ æ–¹æ¡ˆ 1ï¼ˆè·³è½¬åˆ° `/auth/login`ï¼‰**
-   **å¦‚æœæ˜¯å‰åç«¯åˆ†ç¦» â†’ æ–¹æ¡ˆ 2ï¼ˆè¿”å› JSONï¼‰**

ä½ å¯ä»¥æ ¹æ®é¡¹ç›®æ¶æ„é€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆï¼